flowchart TD
    ML["ðŸ›’ Mercado Pago / Mercado Livre"]

    subgraph ENTRADA["Entradas de Dados"]
        BF["Backfill Manual\nGET /backfill/{seller}\npor competÃªncia"]
        DS["Sync DiÃ¡rio\n00:01 BRT\npor competÃªncia + Ãºltima atualizaÃ§Ã£o"]
    end

    subgraph PROC["Processamento"]
        PP["Processador Principal\nprocess_payment_webhook"]
        CL["Classificador Avulso\nclassify_non_order_payment"]
    end

    subgraph FILA["Fila Persistente (ca_jobs)"]
        EX["Executor da Fila\nCaWorker\npoll 1s Â· mÃ¡x 9 req/s"]
    end

    subgraph CA["Conta Azul ERP"]
        CR["Contas a Receber\nReceitas Â· Estornos de Taxa\nSubsÃ­dios"]
        CP["Contas a Pagar\nComissÃµes Â· Fretes\nEstornos de Receita"]
        BX["Baixas\n(parcelas pagas)"]
    end

    subgraph AUX["Processos Auxiliares"]
        BAI["Baixas\n10:00 BRT"]
        FC["Fechamento Financeiro\n11:30 BRT"]
        EXP["Export Legado ZIP\n(dias configurados)"]
    end

    subgraph BD["Banco de Dados (Supabase)"]
        PAY["payments\n(vendas processadas)"]
        JOBS["ca_jobs\n(fila de execuÃ§Ã£o)"]
        EXP2["mp_expenses\n(pagamentos avulsos)"]
        FAT["faturamento\n(dashboard)"]
    end

    ML --> BF
    ML --> DS
    BF --> PP
    DS --> PP
    DS --> CL
    PP --> FILA
    PP --> PAY
    CL --> EXP2
    EX --> CR
    EX --> CP
    EX --> BX
    EX --> PAY
    JOBS --> EX
    PP --> JOBS
    BAI --> JOBS
    FC --> BD
    EXP --> ML
