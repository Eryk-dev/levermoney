## Codebase Patterns
- useAdmin.ts hooks: DO NOT use headers() helper for FormData calls (it sets Content-Type: application/json). Build { 'X-Admin-Token': token } manually.
- FormData + fetch: omit Content-Type header entirely; the browser sets the correct multipart boundary automatically.
- FastAPI multipart endpoints: string fields use Form(), files use File(). Empty string appends are fine for optional Form(None) fields.

# Ralph Progress Log
Started: Wed Feb 25 17:43:25 -03 2026
---

## 2026-02-25 17:52 - US-F02, US-F03, US-F04
- Implemented together since all 3 touch AdminPanel.tsx and build on each other
- US-F02: Added extrato_csv: File | null to ActivationForm interface; file input inside isCAMode block; isCAModeValid now requires extrato_csv; reset extrato_csv when toggling to dashboard_only mode
- US-F03: Added extrato_csv: File | null to UpgradeForm interface; file input after Centro de Custo CA; disabled button when no extrato_csv
- US-F04: Added activationError/upgradeError state; on error set error and keep modal open; on success window.alert extrato summary then close; render error messages before modalActions; added .formError CSS class to AdminPanel.module.css
- Also updated AdminPanelProps to use new return types (extrato_processed, error_detail) and imported ExtratoProcessedStats
- Files changed: dashboard/src/components/AdminPanel.tsx, dashboard/src/components/AdminPanel.module.css
- **Learnings for future iterations:**
  - CSS variables --danger, --text-sm, --space-1 all confirmed present in dashboard/src/index.css
  - The file input uses onChange only (no ref needed); e.target.files?.[0] pattern works cleanly
  - startDatePreview CSS class already exists and works for the filename display preview

---

## 2026-02-25 17:47 - US-F01
- Added ExtratoProcessedStats interface above BackfillProgress in useAdmin.ts
- Extended ActivateSellerConfig with extrato_csv?: File
- Extended UpgradeToCAConfig with extrato_csv: File
- Updated return types for activateSeller and upgradeToCA to include extrato_processed and error_detail
- Converted both functions from JSON body to FormData, with individual fd.append() for each string field
- Used { 'X-Admin-Token': token ?? '' } headers (no Content-Type) for multipart calls
- On !res.ok: reads errData and returns error_detail from errData.detail
- Removed unused `headers` dependency from both useCallback deps arrays
- Files changed: dashboard/src/hooks/useAdmin.ts
- **Learnings for future iterations:**
  - The `headers` useCallback is NOT used in activateSeller/upgradeToCA anymore; remove it from deps
  - TypeScript: `config.extrato_csv` in UpgradeToCAConfig is `File` (required), not `File | undefined`; the `if (config.extrato_csv)` guard still works and avoids ts errors
---
